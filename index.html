<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keyblade Chronicles Character Creator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(to bottom, #1a1a2e, #16213e);
            color: white;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            gap: 20px;
        }
        .left-column {
            flex: 1;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
        }
        .right-column {
            flex: 1;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            position: relative; /* To contain absolutely positioned descriptions */
            min-height: 500px; /* Ensure enough height for all descriptions */
        }
        .description-item {
            position: absolute;
            width: 100%; /* Full width of right column */
            margin-bottom: 10px;
            display: none; /* Hidden until selected */
            left: 0; /* Align to the left edge of the right column */
        }
        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }
        select, input, button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            font-size: 16px;
            border-radius: 5px;
            box-sizing: border-content;
        }
        .stat-select {
            width: 60px; /* Small dropdown for 2-digit numbers */
            display: inline-block;
            margin-left: 10px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        #stats {
            margin: 10px 0;
        }
        #dice-rolls {
            margin: 5px 0;
            font-style: italic;
        }
        #output {
            margin-top: 20px;
            padding: 10px;
            background: #2a2a4a;
            border-radius: 5px;
        }
        h1 {
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Keyblade Chronicles Character Creator</h1>
    <div class="container">
        <div class="left-column">
            <div>
                <label for="name">Name:</label>
                <input type="text" id="name" placeholder="Enter your character's name">
            </div>
            <div>
                <label for="path">Path:</label>
                <select id="path" onchange="updateDescription('path')">
                    <option value="" disabled selected>Select a Path</option>
                    <option value="Light Bearer">Light Bearer</option>
                    <option value="Shadow Striker">Shadow Striker</option>
                    <option value="Spellblade">Spellblade</option>
                    <option value="Stalwart Blade">Stalwart Blade</option>
                    <option value="Swift Blade">Swift Blade</option>
                    <option value="Time Blade">Time Blade</option>
                </select>
            </div>
            <div>
                <button onclick="rollStats()">Roll Stats</button>
                <div id="dice-rolls"></div>
                <div id="stats">
                    <p>HP: <span id="hp">-</span></p>
                    <p>MP: <span id="mp">-</span> <select id="mp-select" class="stat-select" onchange="assignStat('mp')"></select></p>
                    <p>Str: <span id="str">-</span> <select id="str-select" class="stat-select" onchange="assignStat('str')"></select></p>
                    <p>Def: <span id="def">-</span> <select id="def-select" class="stat-select" onchange="assignStat('def')"></select></p>
                    <p>AP: <span id="ap">-</span> <select id="ap-select" class="stat-select" onchange="assignStat('ap')"></select></p>
                    <p>Luck: <span id="luck">-</span> <select id="luck-select" class="stat-select" onchange="assignStat('luck')"></select></p>
                </div>
            </div>
            <div>
                <label for="keyblade">Keyblade:</label>
                <select id="keyblade" onchange="updateDescription('keyblade')">
                    <option value="" disabled selected>Select a Keyblade</option>
                    <option value="Kingdom Key">Kingdom Key</option>
                    <option value="Way to Dawn">Way to Dawn</option>
                    <option value="Star Seeker">Star Seeker</option>
                    <option value="Earthshaker">Earthshaker</option>
                    <option value="Oathkeeper">Oathkeeper</option>
                    <option value="Rainfell">Rainfell</option>
                </select>
            </div>
            <div>
                <label for="equipment">Equipment:</label>
                <select id="equipment" onchange="updateDescription('equipment')">
                    <option value="" disabled selected>Select an Accessory</option>
                    <option value="Light Charm">Light Charm</option>
                    <option value="Shadow Veil">Shadow Veil</option>
                    <option value="Ether Crystal">Ether Crystal</option>
                    <option value="Defender’s Crest">Defender’s Crest</option>
                    <option value="Trick Coin">Trick Coin</option>
                    <option value="Hourglass Pendant">Hourglass Pendant</option>
                </select>
            </div>
            <div>
                <label for="spell1">Spell 1:</label>
                <select id="spell1" onchange="updateSpellOptions('spell1')">
                    <option value="" disabled selected>Select a Spell</option>
                    <option value="Fire">Fire</option>
                    <option value="Blizzard">Blizzard</option>
                    <option value="Thunder">Thunder</option>
                    <option value="Cure">Cure</option>
                </select>
                <div id="spell2Container" style="display: none;">
                    <label for="spell2">Spell 2 (Spellblade only):</label>
                    <select id="spell2" onchange="updateSpellOptions('spell2')">
                        <option value="" disabled selected>Select a Spell</option>
                        <option value="Fire">Fire</option>
                        <option value="Blizzard">Blizzard</option>
                        <option value="Thunder">Thunder</option>
                        <option value="Cure">Cure</option>
                    </select>
                </div>
            </div>
            <div>
                <label for="backstory">Backstory:</label>
                <input type="text" id="backstory" placeholder="A short backstory">
            </div>
            <button onclick="createCharacter()">Create Character</button>
            <div id="output"></div>
        </div>
        <div class="right-column">
            <div id="pathDescription" class="description-item"></div>
            <div id="keybladeDescription" class="description-item"></div>
            <div id="equipmentDescription" class="description-item"></div>
        </div>
    </div>

    <script>
        let character = {
            name: "",
            path: "",
            hp: 0,
            mp: 0,
            str: 0,
            def: 0,
            ap: 0,
            luck: 0,
            keyblade: "",
            equipment: "",
            spells: [],
            backstory: ""
        };
        let availableRolls = [];
        let originalRolls = [];
        let assignedRolls = {
            mp: 0,
            str: 0,
            def: 0,
            ap: 0,
            luck: 0
        };

        const descriptions = {
            path: {
                "Light Bearer": "A champion of hope and friendship, like Sora. Light Bearers wield their Keyblades with balance and heart, blending combat and support.",
                "Shadow Striker": "A warrior embracing the edge of darkness, like Riku. Shadow Strikers wield their Keyblade with raw power, risking themselves for devastating strikes.",
                "Spellblade": "A magical Keyblade master, like Donald or Mickey. Spellblades fuse spells and strikes, wielding their Keyblade as a conduit for arcane might.",
                "Stalwart Blade": "A protector of allies, like Goofy or Terra. Stalwart Blades wield their Keyblade to shield and endure, standing as a bulwark against harm.",
                "Swift Blade": "A nimble and cunning wielder, like Roxas or Ventus. Swift Blades dance through combat, striking fast and trusting luck to prevail.",
                "Time Blade": "A temporal Keyblade master, like Aqua. Time Blades wield their Keyblade with precision, blending magic and control to bend battle’s flow."
            },
            keyblade: {
                "Kingdom Key": "A simple, iconic blade of light and balance, wielded by Sora.",
                "Way to Dawn": "A shadowed Keyblade of dusk and redemption, favored by Riku.",
                "Star Seeker": "A star-tipped blade pulsing with magical potential, tied to Mickey’s lineage.",
                "Earthshaker": "A rugged, heavy Keyblade of unyielding strength, once Terra’s.",
                "Oathkeeper": "A sleek, swift blade of promise and memory, linked to Roxas and Sora.",
                "Rainfell": "A graceful, flowing Keyblade of time and elegance, Aqua’s chosen weapon."
            },
            equipment: {
                "Light Charm": "Reroll one failed Luck check per session. A token of hope for Light Bearers.",
                "Shadow Veil": "The first attack against you in combat has a -1 penalty to hit. A dark shroud for Shadow Strikers.",
                "Ether Crystal": "Restore 2 MP once per session. A mystic gem for Spellblades.",
                "Defender’s Crest": "Add 1 to your Defense when protecting an ally. A sturdy emblem for Stalwart Blades.",
                "Trick Coin": "Flip it once per session: heads doubles your Luck for one roll, tails halves it. A gambler’s tool for Swift Blades.",
                "Hourglass Pendant": "Regain 1 MP when you use a spell or ability, once per session. A timely relic for Time Blades."
            }
        };

        function updateDescription(type) {
            const value = document.getElementById(type).value;
            const descriptionItem = document.getElementById(`${type}Description`);

            if (value && descriptions[type][value]) {
                descriptionItem.style.display = 'block';
                descriptionItem.innerHTML = descriptions[type][value];

                // Align with the corresponding dropdown, inside the right column
                const dropdown = document.getElementById(type);
                const rect = dropdown.getBoundingClientRect();
                const rightColumn = document.querySelector('.right-column');
                const rightRect = rightColumn.getBoundingClientRect();
                descriptionItem.style.top = `${rect.top + window.scrollY - 90}px`; // Adjusted offset to move up by one line
                descriptionItem.style.left = `${0}px`; // Align to the left edge of the right column
            } else {
                descriptionItem.style.display = 'none';
            }

            // Show/hide Spell 2 for Spellblade
            if (type === "path" && value === "Spellblade") {
                document.getElementById('spell2Container').style.display = 'block';
                updateSpellOptions('spell1'); // Update spell options when Spellblade is selected
            } else if (type === "path" && value !== "Spellblade") {
                document.getElementById('spell2Container').style.display = 'none';
                character.spells = [document.getElementById('spell1').value]; // Reset to one spell
                updateSpellOptions('spell1'); // Reset spell options
            }
        }

        function updateSpellOptions(changedSpell) {
            const spell1 = document.getElementById('spell1');
            const spell2 = document.getElementById('spell2');
            const spellOptions = ["", "Fire", "Blizzard", "Thunder", "Cure"];

            const spell1Value = spell1.value;
            const spell2Value = spell2.value;

            if (changedSpell === 'spell1') {
                // Update Spell 2 dropdown based on Spell 1 selection
                const currentSpell2 = spell2.value;
                spell2.innerHTML = ''; // Clear Spell 2 options
                spellOptions.forEach(option => {
                    if (option === spell1Value) return; // Skip the spell chosen in Spell 1
                    const opt = document.createElement('option');
                    opt.value = option;
                    opt.text = option || "Select a Spell";
                    if (option === "") opt.disabled = true;
                    if (option === currentSpell2) opt.selected = true;
                    spell2.appendChild(opt);
                });
            } else if (changedSpell === 'spell2') {
                // Update Spell 1 dropdown based on Spell 2 selection
                const currentSpell1 = spell1.value;
                spell1.innerHTML = ''; // Clear Spell 1 options
                spellOptions.forEach(option => {
                    if (option === spell2Value) return; // Skip the spell chosen in Spell 2
                    const opt = document.createElement('option');
                    opt.value = option;
                    opt.text = option || "Select a Spell";
                    if (option === "") opt.disabled = true;
                    if (option === currentSpell1) opt.selected = true;
                    spell1.appendChild(opt);
                });
            }
        }

        function rollStats() {
            let rolls = Array(5).fill().map(() => Math.floor(Math.random() * 6) + 1); // Roll 5d6 for stats
            let hpRolls = rolls.slice(0, 4); // Use first 4 for HP
            hpRolls.sort((a, b) => a - b).shift(); // Drop lowest
            character.hp = hpRolls.reduce((sum, val) => sum + val, 0);

            // Display individual rolls
            let remainingRolls = rolls.slice(4); // Last roll for initial available pool
            availableRolls = [...remainingRolls, ...Array(4).fill().map(() => Math.floor(Math.random() * 6) + 1)]; // Add 4 more rolls
            originalRolls = [...availableRolls]; // Store original rolls for dropdowns
            document.getElementById('dice-rolls').innerHTML = `Dice Rolled: ${availableRolls.join(', ')}`;

            // Set HP automatically
            document.getElementById('hp').textContent = character.hp;

            // Reset assigned rolls
            assignedRolls = {
                mp: 0,
                str: 0,
                def: 0,
                ap: 0,
                luck: 0
            };
            character.mp = 0;
            character.str = 0;
            character.def = 0;
            character.ap = 0;
            character.luck = 0;
            document.getElementById('mp').textContent = '-';
            document.getElementById('str').textContent = '-';
            document.getElementById('def').textContent = '-';
            document.getElementById('ap').textContent = '-';
            document.getElementById('luck').textContent = '-';

            // Populate dropdowns with available rolls
            updateStatDropdowns();
        }

        function updateStatDropdowns() {
            const stats = ['mp', 'str', 'def', 'ap', 'luck'];
            // Calculate currently assigned rolls
            let assignedValues = stats
                .filter(s => s !== statBeingUpdated) // Exclude the stat being updated
                .map(s => character[s])
                .filter(val => val !== 0); // Exclude unassigned (0) values

            stats.forEach(stat => {
                const select = document.getElementById(`${stat}-select`);
                const currentValue = character[stat] || 0;
                select.innerHTML = ''; // Clear existing options
                const optDefault = document.createElement('option');
                optDefault.value = '';
                optDefault.text = 'Select';
                optDefault.disabled = true;
                if (!currentValue) optDefault.selected = true;
                select.appendChild(optDefault);

                // Show all original rolls except those assigned to other stats
                originalRolls.forEach(roll => {
                    // Check if the roll is assigned to another stat (excluding the current stat)
                    let isAssignedToAnother = assignedValues.includes(roll) && roll !== currentValue;
                    if (!isAssignedToAnother) {
                        const opt = document.createElement('option');
                        opt.value = roll;
                        opt.text = roll;
                        if (roll === currentValue) opt.selected = true;
                        select.appendChild(opt);
                    }
                });
            });
        }

        let statBeingUpdated = null; // Track which stat is being updated

        function assignStat(stat) {
            statBeingUpdated = stat; // Set the stat being updated
            const select = document.getElementById(`${stat}-select`);
            const value = parseInt(select.value);
            if (value) {
                // If there was a previously assigned value, return it to the pool
                const previousValue = character[stat];
                if (previousValue && previousValue !== 0) {
                    availableRolls.push(previousValue);
                }

                // Assign the new value
                character[stat] = value;
                document.getElementById(stat).textContent = value;

                // Remove the newly assigned value from the pool
                const index = availableRolls.indexOf(value);
                if (index !== -1) {
                    availableRolls.splice(index, 1); // Remove only the first instance
                }

                // Update dropdowns
                updateStatDropdowns();
            }
            statBeingUpdated = null; // Reset after update
        }

        function createCharacter() {
            character.name = document.getElementById('name').value || "Unnamed Wielder";
            character.path = document.getElementById('path').value;
            character.keyblade = document.getElementById('keyblade').value;
            character.equipment = document.getElementById('equipment').value;

            let spell1 = document.getElementById('spell1').value;
            character.spells = [spell1];
            if (character.path === "Spellblade") {
                let spell2 = document.getElementById('spell2').value;
                if (spell2 && spell2 !== spell1) character.spells.push(spell2);
            }

            character.backstory = document.getElementById('backstory').value || "A mysterious hero.";

            let output = `
                Name: ${character.name}<br>
                Path: ${character.path}<br>
                Stats: HP ${character.hp}, MP ${character.mp}, Str ${character.str}, Def ${character.def}, AP ${character.ap}, Luck ${character.luck}<br>
                Keyblade: ${character.keyblade}<br>
                Equipment: ${character.equipment}<br>
                Spells: ${character.spells.join(", ")}<br>
                Backstory: ${character.backstory}
            `;
            document.getElementById('output').innerHTML = output;
        }
    </script>
</body>
</html>
